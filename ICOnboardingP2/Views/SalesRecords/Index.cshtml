
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Sales Records</h2>

<section>
    <button type="button" id="addNewProductSoldBtn" class="btn btn-primary" data-toggle="modal" data-target="#newProductSoldModal">
        Add New Sale Record
    </button>

    @*Add new sale record modal*@
    <div class="modal fade" id="newProductSoldModal" tabindex="-1" role="dialog" aria-labelledby="newProductSoldModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newProductSoldModalLabel">Add New Sale Record</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                    <form id="newProductSoldForm">
                        <div class="form-group">
                            <label for="newProductSoldCustomerList">Customer Name</label>
                            <select id="newProductSoldCustomerList" class="custom-select" required></select>
                        </div>
                        <div class="form-group">
                            <label for="newProductSoldProductList">Product Name</label>
                            <select id="newProductSoldProductList" class="custom-select" required></select>
                        </div>
                        <div class="form-group">
                            <label for="newProductSoldStoreList">Store Name</label>
                            <select id="newProductSoldStoreList" class="custom-select" required></select>
                        </div>
                        <div class="form-group">
                            <label for="newProductSoldDate">Date Sold</label>
                            <input type="text" class="form-control" id="newProductSoldDate" placeholder="YYYY-MM-DD">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="newProductSoldSubmit">Save</button>
                </div>
            </div>
        </div>
    </div>
</section>

@*@*Delete ProductSold Confirmation Modal*@
<div class="modal fade" id="deleteProductSoldModal" tabindex="-1" role="dialog" aria-labelledby="deleteProductSoldModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="DeleteProductSoldModalLabel">Delete ProductSold</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Do you want to delete this Sales Record?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" data-dismiss="modal">No</button>
                <button type="button" class="btn btn-danger" id="deleteProductSoldSubmit">Yes</button>
            </div>
        </div>
    </div>
</div>*@

<table id="ProductSolds" class="table table-light table-hover">
    <thead>
        <tr>
            <th>Customer Name</th>
            <th>Product Name</th>
            <th>Store Name</th>
            <th>Date Sold</th>
            <th>Action(Edit)</th>
            <th>Action(Delete)</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

@section scripts
    {
    <script>
        //Add dataTable
        $(document).ready(function () {
            $("#ProductSolds").DataTable({
                ajax: {
                    url: "api/salesrecords",
                    dataSrc: ""
                },
                columns: [
                    {
                        data: "customer.name"
                    },
                    {
                        data: "product.name"
                    },
                    {
                        data: "store.name"
                    },
                    {
                        data: "dateSold",
                        render: function (data) {
                            return moment(data).format("DD/MM/YYYY");
                        }
                    },
                    {
                        data: "id",
                        render: function (data) {
                            return "<button class = 'btn btn-warning' id='editProductSoldBtn' edit-ProductSold-id=" + data + ">Edit</button>";
                        }
                    },
                    {
                        data: "id",
                        render: function (data) {
                            return "<button class = 'btn btn-danger' id='deleteProductSoldBtn' delete-ProductSold-id=" + data + ">Delete</button>";
                        }
                    }
                ]
            });

            //Populate new sale record modal
            $("#addNewProductSoldBtn").click(function () {
                $.ajax({
                    url: "api/customers",
                    method: "GET",
                    success: function (data) {
                        var listCustomers = "<option value=''>Please select a customer</option>"
                        $.each(data, function (index, customer) {
                            listCustomers += "<option value='" + customer.id + "'>" + customer.name + "</option>"
                        });
                        $("#newProductSoldCustomerList").html(listCustomers);
                    }
                });

                $.ajax({
                    url: "api/products",
                    method: "GET",
                    success: function (data) {
                        var listProducts = "<option value=''>Please select a product</option>"
                        $.each(data, function (index, product) {
                            listProducts += "<option value='" + product.id + "'>" + product.name + "</option>"
                        });
                        $("#newProductSoldProductList").html(listProducts);
                    }
                });

                $.ajax({
                    url: "api/stores",
                    method: "GET",
                    success: function (data) {
                        var listStores = "<option value=''>Please select a store</option>"
                        $.each(data, function (index, store) {
                            listStores += "<option value='" + store.id + "'>" + store.name + "</option>"
                        });
                        $("#newProductSoldStoreList").html(listStores);
                    }
                });

                //Add new Sale Record
                $("#newProductSoldSubmit").click(function () {
                    var formdata = {
                        "customerId": $("#newProductSoldCustomerList").val(),
                        "productId": $("#newProductSoldProductList").val(),
                        "storeId": $("#newProductSoldStoreList").val(),
                        "dateSold": $("#newProductSoldDate").val()
                    };
                    $.ajax({
                        url: "api/salesrecords",
                        method: "POST",
                        data: JSON.stringify(formdata),
                        contentType: "application/json;charset=utf-8",
                        processData: true,
                        success: function () {
                            $("#newProductSoldModal").modal("hide");
                            location.reload(true);
                        },
                        error: function (xhr) {
                            alert(xhr.responseText);
                        }
                    });
                });
            });



            ////Delete ProductSold
            //$("#ProductSolds").on("click", "#deleteProductSoldBtn", function () {

            //    var ProductSoldId = $(this).attr("delete-ProductSold-id");

            //    $("#deleteProductSoldModal").modal("show");

            //    $("#deleteProductSoldSubmit").click(function () {

            //        $.ajax({
            //            url: "/api/ProductSolds/" + ProductSoldId,
            //            method: "DELETE",
            //            success: function () {
            //                $("#deleteProductSoldModal").modal("hide");
            //                location.reload(true);
            //            }
            //        });
            //    });
            //});

            //    //Edit ProductSold
            //    $("#ProductSolds").on("click", "#editProductSoldBtn", function () {
            //        var ProductSoldId = $(this).attr("edit-ProductSold-id");

            //        $("#editProductSoldModal").modal("show");

            //        $.ajax({
            //            url: "api/ProductSolds/" + ProductSoldId,
            //            method: "GET",
            //            success: function (data) {

            //                var ProductSoldData = JSON.parse(JSON.stringify(data));
            //                $("#ProductSoldName").attr("placeholder", ProductSoldData.name);
            //                $("#ProductSoldAddress").attr("placeholder", ProductSoldData.address);

            //                $("#editProductSoldSubmit").click(function () {
            //                    var formdata = {
            //                        "name": $("#ProductSoldName").val(),
            //                        "address": $("#ProductSoldAddress").val()
            //                    };
            //                    $.ajax({
            //                        url: "/api/ProductSolds/" + ProductSoldId,
            //                        method: "PUT",
            //                        data: JSON.stringify(formdata),
            //                        contentType: "application/json;charset=utf-8",
            //                        processData: true,
            //                        success: function () {
            //                            $("#editProductSoldModal").modal("hide");
            //                            location.reload(true);
            //                        },
            //                        error: function (xhr) {
            //                            alert(xhr.responseText);
            //                        }
            //                    });
            //                });
            //            },
            //            error: function (xhr) {
            //                alert(xhr.responseText);
            //            }
            //        });
            //    });
        });
    </script>

    @Scripts.Render("~/bundles/jqueryval")
}






@*Edit ProductSold Modal*
    <div class="modal fade" id="editProductSoldModal" tabindex="-1" role="dialog" aria-labelledby="editProductSoldModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProductSoldModalLabel">Edit ProductSold</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h4>ProductSold Details</h4>
                    <form id="editProductSoldForm">
                        <div class="form-group">
                            <label for="ProductSoldName">Name</label>
                            <input type="text" class="form-control" id="ProductSoldName">
                        </div>
                        <div class="form-group">
                            <label for="ProductSoldAddress">Address</label>
                            <input type="text" class="form-control" id="ProductSoldAddress">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="editProductSoldSubmit">Save</button>
                </div>
            </div>
        </div>
    </div>*@
